// routes/kiosque.js - Routes compl√®tes pour le workflow kiosque

const express = require('express');
const router = express.Router();
const { 
    // Fonctions existantes
    createKiosqueInteraction, 
    assignVestiaireToInteraction, 
    getKiosqueInteractions,
    
    // Nouvelles fonctions
    getKiosqueCapacity,
    createKiosqueSession,
    validateKiosqueSession,
    getKiosqueStats
} = require('../controllers/kiosqueController');

// ============================================================
// ROUTES EXISTANTES (CONSERV√âES)
// ============================================================

// POST /api/kiosque - Cr√©er une interaction kiosque
router.post('/', createKiosqueInteraction);

// POST /api/kiosque/vestiaire - Assigner un vestiaire √† une interaction
router.post('/vestiaire', assignVestiaireToInteraction);

// GET /api/kiosque - R√©cup√©rer toutes les interactions kiosque
router.get('/', getKiosqueInteractions);

// ============================================================
// NOUVELLES ROUTES POUR LE WORKFLOW KIOSQUE
// ============================================================

/**
 * üÜï GET /api/kiosque/capacity
 * R√©cup√©rer la capacit√© disponible en temps r√©el
 * Utilis√© par l'Interface 1 pour le polling
 */
router.get('/capacity', getKiosqueCapacity);

/**
 * üÜï POST /api/kiosque/session
 * Cr√©er une session kiosque (optionnel - pour √©volution future)
 * Actuellement, on utilise localStorage c√¥t√© client
 * Cette route est pr√™te si tu veux cr√©er la session d√®s l'Interface 1
 */
router.post('/session', createKiosqueSession);

/**
 * üÜï POST /api/kiosque/validate
 * Valider une session kiosque compl√®te (Interface 4)
 * - V√©rifie la capacit√© en temps r√©el
 * - D√©compte la capacit√©
 * - Cr√©e la session avec toute la commande
 * - Transaction atomique pour √©viter les race conditions
 */
router.post('/validate', validateKiosqueSession);

/**
 * üÜï GET /api/kiosque/stats
 * R√©cup√©rer les statistiques du jour
 * - Nombre de sessions
 * - Taux de conversion
 * - Chiffre d'affaires
 */
router.get('/stats', getKiosqueStats);

// ============================================================
// EXPORTS
// ============================================================

module.exports = router;
